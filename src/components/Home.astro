---
import FormattedDate from "@src/components/FormattedDate.astro";
import LangSelector from "@src/components/LangSelector.astro";
import Link from "@src/components/Link.astro";
import SocialLinks from "@src/components/SocialLinks.astro";
import { getPostsByLang } from "@src/services/posts";
import Layout from "@src/layouts/Layout.astro";
import { LOCALES, useTranslations, type LangType } from "@src/i18n/utils";
import { SITE } from "@src/consts";

type Props = {
  lang: LangType;
};

const { lang } = Astro.props;
const t = useTranslations(lang);
const latestPosts = (await getPostsByLang(lang)).slice(0, 5);
---

<Layout
  title={t("site.title")}
  description={t("site.description", { firstname: SITE.authorFirstName })}
  lang={lang}
>
  <LangSelector slot="lang-selector" locales={LOCALES} />
  <main>
    <section class="hero">
      <div class="hero-content">
        <h1>{t("home.hello")}</h1>
        <p>
          <Fragment
            set:html={t("site.description", {
              firstname: SITE.authorFirstName,
            })}
          />
        </p>
        <SocialLinks />
      </div>
      <div class="card-img">
        <img src="/images/mack.png" alt={SITE.author} />
      </div>
    </section>
    <hr />
    <section class="latest-posts">
      <h3>ðŸ“œ {t("home.latest-post")}</h3>
      <ul>
        {
          latestPosts.map((post) => (
            <li>
              <Link href={post.pathname} lang={lang}>
                {post.data.title}
              </Link>
              <FormattedDate date={post.data.pubDate} />
              <p>{post.data.description}</p>
            </li>
          ))
        }
      </ul>
      <Link href="/posts" lang={lang} class="all-posts">All posts â†’</Link>
    </section>
  </main>
</Layout>
