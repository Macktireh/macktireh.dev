---
title: "Exploiter les API dans Power BI : Authentification JWT et Pagination avec Power Query"
description: "D√©couvrez comment int√©grer des donn√©es d'API REST dans Power BI avec Power Query. Guide pratique couvrant l'authentification JWT, la pagination automatique et la cr√©ation de fonctions r√©utilisables."
pubDate: "Feb 01 2026"
tags: ["Power BI", "Power Query", "API", "Authentification", "Pagination"]
lang: "fr"
heroImage: "https://github.com/user-attachments/assets/7df5048d-ffd0-4a30-9cb0-7ff7320a15cd"
giscusTitleDiscussionsMapping: "Flexible Data Source Management in Power BI with MySQL"
---

import Link from "@src/components/Link.astro";
import PostImage from "@src/components/PostImage.astro";
import Note from "@src/components/Note.astro";

### Table des mati√®res

- [Introduction](#introduction)
- [Exploration de l'API DummyJSON](#exploration-de-lapi-dummyjson)
- [Configuration des param√®tres et des fonctions Power Query](#configuration-des-param√®tres-et-des-fonctions-power-query)
  - [1. Param√®tres globaux](#1-configuration-des-param√®tres-globaux-power-query)
  - [2. Fonctions utilitaires HTTP](#2-fonctions-utilitaires-pour-les-requ√™tes-http)
  - [3. Gestion de l'authentification](#3-gestion-de-lauthentification)
  - [4. R√©cup√©ration et pagination](#4-r√©cup√©ration-des-donn√©es-et-gestion-de-la-pagination)
- [Utilisation pratique](#importation-des-donn√©es-dans-power-bi-utilisation-de-la-fonction-fetchdatafromapi)
- [Conclusion](#conclusion)

<br />

## Introduction

Si vous utilisez Power BI, vous avez probablement d√©j√† eu besoin d'importer des donn√©es depuis une API REST. Et vous savez quoi ? Ce n'est pas toujours une partie de plaisir ! Entre l'authentification, les en-t√™tes HTTP, la pagination... on peut vite se perdre.

Dans cet article, je vais vous montrer concr√®tement comment importer des donn√©es d'une API dans Power BI en utilisant Power Query. On va voir ensemble comment g√©rer l'authentification JWT et la pagination, le tout avec un exemple pratique bas√© sur l'API <Link href="https://dummyjson.com" external>DummyJSON</Link>. C'est une API gratuite et simple qui simule parfaitement les cas d'usage r√©els.

**Avant de commencer**, j'imagine que vous :
- Connaissez d√©j√† les bases de Power BI Desktop
- Avez d√©j√† ouvert l'√©diteur Power Query au moins une fois
- Comprenez les concepts de base des API REST (GET, POST, en-t√™tes, JSON)

Si c'est le cas, parfait ! On peut y aller.

<br />

## Exploration de l'API DummyJSON

Avant de plonger dans le code, prenons quelques minutes pour comprendre comment fonctionne l'API qu'on va utiliser. <Link href="https://dummyjson.com" external>DummyJSON</Link> est une ressource g√©niale qui fournit des donn√©es fictives (produits, utilisateurs, articles, etc.) et simule les m√©canismes typiques des vraies API : authentification, pagination, etc.

Voici le processus g√©n√©ral pour r√©cup√©rer des donn√©es depuis une API prot√©g√©e :

<PostImage
  src="https://github.com/user-attachments/assets/2418584b-c52b-46a7-9991-28f431bef14a"
  alt="Sch√©ma des √©tapes de r√©cup√©ration des donn√©es"
/>

<br />

#### √âtape 1 : L'authentification

**Envoi des identifiants**

La premi√®re chose √† faire, c'est s'authentifier. On envoie une requ√™te `POST` √† l'endpoint `/auth/login` avec nos identifiants au format JSON :

```json
{
  "username": "emilys",
  "password": "emilyspass"
}
```

**R√©ception des jetons**

En retour, l'API nous donne un objet JSON avec deux jetons importants :
- `accessToken` : c'est notre s√©same pour acc√©der aux donn√©es prot√©g√©es
- `refreshToken` : il servira √† renouveler l'access token quand il expirera

<br />

#### √âtape 2 : R√©cup√©ration des donn√©es

**Envoi de la requ√™te avec le jeton**

Maintenant qu'on a notre `accessToken`, on peut demander les donn√©es ! On envoie une requ√™te `GET` √† `/auth/products` en incluant le jeton dans l'en-t√™te `Authorization` comme ceci : `Bearer votre_access_token`.

**R√©ception des donn√©es**

L'API nous renvoie un objet JSON contenant :
- La liste des produits dans le champ `products`
- Des infos sur la pagination : `total` (nombre total d'√©l√©ments), `skip` (combien on en a saut√©), `limit` (combien on en r√©cup√®re par page)

Voici un exemple de r√©ponse simplifi√©e :

```json
{
  "products": [
    {
      "id": 1,
      "title": "iPhone 13 Pro",
      "description": "Latest iPhone model with advanced features",
      "category": "Electronics",
      "price": 999.99,
      "discountPercentage": 10.5,
      "rating": 4.7,
      "stock": 50,
      "brand": "Apple",
      ...
    },
    ...
  ],
  "total": 80,
  "skip": 0,
  "limit": 20
}
```

Vous voyez le principe ? Maintenant qu'on comprend le fonctionnement, passons √† l'impl√©mentation dans Power Query !

<br />

## Configuration des param√®tres et des fonctions Power Query

C'est parti pour le code ! On va construire notre solution √©tape par √©tape en cr√©ant des param√®tres et des fonctions r√©utilisables. L'id√©e, c'est de faire les choses proprement d√®s le d√©part pour faciliter la maintenance et les √©volutions futures.

### 1. Configuration des param√®tres globaux Power Query

Commen√ßons par cr√©er des param√®tres qui vont centraliser toutes nos configurations. Comme √ßa, si vous devez changer l'URL de l'API ou vos identifiants, vous n'aurez qu'un seul endroit √† modifier !

**Comment faire :**
1. Dans l'√âditeur Power Query, allez dans l'onglet `Accueil`
2. Cliquez sur `G√©rer les param√®tres` > `Nouveau param√®tre`
3. Cr√©ez les param√®tres suivants :

    - `API_BASE_URL` :
        - `Description` : L'URL de base de l'API
        - `Type` : Texte
        - `Valeur` : https://dummyjson.com
    - `API_LOGIN_USERNAME` :
        - `Description` : Votre nom d'utilisateur
        - `Type` : Texte
        - `Valeur` : emilys
    - `API_LOGIN_PASSWORD` :
        - `Description` : Votre mot de passe
        - `Type` : Texte
        - `Valeur` : emilyspass
    - `API_PAGINATION_SKIP` :
        - `Description` : Point de d√©part pour la pagination
        - `Type` : Nombre d√©cimal
        - `Valeur` : 0
    - `API_PAGINATION_LIMIT` :
        - `Description` : Nombre d'√©l√©ments par page
        - `Type` : Nombre d√©cimal
        - `Valeur` : 20

<PostImage
  src="https://github.com/user-attachments/assets/7fb091cc-b821-401d-b621-dc93c0bae3d9"
  alt="Param√®tres power query"
/>

<br />

### 2. Fonctions utilitaires pour les requ√™tes HTTP

Maintenant, on va cr√©er quatre fonctions "briques de base" qui vont nous simplifier la vie pour tous nos appels API. Ces fonctions vont g√©rer les en-t√™tes, les param√®tres de requ√™te, et les appels HTTP eux-m√™mes.

**Comment cr√©er une fonction :**
1. Dans l'√âditeur Power Query, onglet `Accueil`
2. Cliquez sur `Nouvelle source` > `Requ√™te vide`
3. Ouvrez l'√©diteur avanc√©
4. Collez le code de la fonction
5. Donnez-lui un nom explicite

<br />

#### 2.1 `GetHeaderParameters` : Pr√©parer les en-t√™tes HTTP

Cette fonction configure les en-t√™tes de base n√©cessaires pour nos requ√™tes HTTP. Elle d√©finit par d√©faut le type de contenu en JSON et peut accepter des en-t√™tes suppl√©mentaires si besoin.

```powerquery title="GetHeadersParameters"
let
    GetHeadersParameters = (optional Headers as record) =>
        let
            Headers = Record.Combine({
                [#"Content-Type" = "application/json"],
                (Headers ?? [])
            })
        in
            Headers
in
    GetHeadersParameters
```

Elle cr√©e un enregistrement avec `Content-Type: application/json` et fusionne avec d'√©ventuels en-t√™tes suppl√©mentaires que vous passez en param√®tre.

#### 2.2 `GetQueryParameters` : G√©rer les param√®tres de pagination

Cette fonction pr√©pare les param√®tres d'URL pour la pagination. Elle utilise les param√®tres globaux qu'on a d√©finis plus t√¥t.

```powerquery title="GetQueryParameters"
let
    GetQueryParameters = (optional Skip as number, optional Query as record) =>
        let
            Query = Record.Combine({
                [
                    skip = Number.ToText(Skip ?? API_PAGINATION_SKIP),
                    limit = Number.ToText(API_PAGINATION_LIMIT)
                ],
                (Query ?? [])
            })
        in
            Query
in
    GetQueryParameters
```

Elle construit un objet avec les param√®tres `skip` et `limit` pour la pagination, et peut inclure d'autres param√®tres si vous en passez.

#### 2.3 `HttpClientGetRequest` : Effectuer les requ√™tes GET

Voici notre fonction pour les requ√™tes GET. Elle utilise `Web.Contents` de Power Query pour faire l'appel HTTP.

```powerquery title="HttpClientGetRequest"
let
    HttpClientGetRequest = (
        RelativePath as text,
        optional Query as record,
        optional Headers as record
    ) =>
        let
            Options = [
                RelativePath = RelativePath,
                Query = (Query ?? []),
                Headers = (Headers ?? [])
            ],
            RawData = Web.Contents(API_BASE_URL, Options),
            Json = Json.Document(RawData)
        in
            Json
in
    HttpClientGetRequest
```

Elle combine l'URL de base avec le chemin relatif, ajoute les param√®tres de requ√™te et les en-t√™tes, fait l'appel HTTP, et retourne le r√©sultat en JSON.

#### 2.4 `HttpClientPostRequest` : Effectuer les requ√™tes POST

M√™me principe que pour GET, mais pour les requ√™tes POST qui incluent un corps de requ√™te.

```powerquery title="HttpClientPostRequest"
let
    HttpClientPostRequest = (
        RelativePath as text,
        optional Query as record,
        optional Headers as record,
        optional Body as record
    ) =>
        let
            Options = [
                RelativePath = RelativePath,
                Query = (Query ?? []),
                Headers = (Headers ?? []),
                Content = Json.FromValue(Body ?? [])
            ],
            RawData = Web.Contents(API_BASE_URL, Options),
            Json = Json.Document(RawData)
        in
            Json
in
    HttpClientPostRequest
```

Pareil que GET, mais avec un param√®tre `Body` en plus. Le fait d'ajouter `Content` √† l'option transforme automatiquement la requ√™te en POST.

<Note>
  **Pourquoi deux fonctions s√©par√©es ?**
  
  Vous vous demandez peut-√™tre pourquoi je ne fais pas une seule fonction g√©n√©rique qui g√®re GET et POST ? Bonne question ! J'ai essay√©, et √ßa fonctionne... mais √ßa pose un probl√®me.
  
  <details>
    <summary>Cliquez pour voir la fonction g√©n√©rique et comprendre le probl√®me</summary>

    ```powerquery title="HttpClient"
    let
        HttpClient = (
            RelativePath as text,
            optional Query as record,
            optional Headers as record,
            optional Body as record
        ) =>
            let
                GetOptions = [
                    RelativePath = RelativePath,
                    Query = (Query ?? []),
                    Headers = (Headers ?? [])
                ],
                PostOptions = [
                    RelativePath = RelativePath,
                    Query = (Query ?? []),
                    Headers = (Headers ?? []),
                    Content = Json.FromValue(Body ?? [])
                ],
                Options = if Body <> null and Record.FieldCount(Body) > 0
                    then PostOptions
                    else GetOptions,
                RawData = Web.Contents(API_BASE_URL, Options),
                Json = Json.Document(RawData)
            in
                Json
    in
        HttpClient
    ```

    **Le probl√®me :** Power Query consid√®re les options de `Web.Contents` comme dynamiques (√† cause du `if`), et √ßa g√©n√®re un avertissement dans les param√®tres de source de donn√©es. R√©sultat ? Vous ne pourrez pas planifier le rafra√Æchissement automatique dans le Power BI Service !
    
    ![Data source settings](https://github.com/user-attachments/assets/2636a861-6fc0-4504-bf18-19656618322b)

    C'est pour √ßa que j'ai pr√©f√©r√© s√©parer en deux fonctions distinctes. Si vous avez une meilleure solution, je suis tout ou√Øe dans les commentaires !
  </details>
</Note>

<br />

### 3. Gestion de l'authentification

Maintenant qu'on a nos fonctions de base, occupons-nous de l'authentification JWT.

#### 3.1 `GetJwtTokens` : Obtenir les jetons d'acc√®s

Cette fonction se connecte √† l'API et r√©cup√®re nos pr√©cieux jetons.

```powerquery title="GetJwtTokens"
let
    GetJwtTokens = () =>
        let
            Headers = GetHeadersParameters(),
            Query = [],
            Body = [
                username = API_LOGIN_USERNAME,
                password = API_LOGIN_PASSWORD
            ],
            Response = HttpClientPostRequest("auth/login", Query, Headers, Body),
            JwtTokens = [
                accessToken = Record.Field(Response, "accessToken"),
                refreshToken = Record.Field(Response, "refreshToken")
            ]
        in
            JwtTokens
in
    GetJwtTokens
```

Elle envoie une requ√™te POST avec vos identifiants √† `/auth/login` et extrait les jetons d'acc√®s et de rafra√Æchissement de la r√©ponse.

#### 3.2 `GetHeadersParametersWithAccessToken` : Ajouter le jeton aux en-t√™tes

Cette fonction combine tout ce qu'on a fait jusqu'ici : elle r√©cup√®re le jeton et l'ajoute aux en-t√™tes HTTP.

```powerquery title="GetHeadersParametersWithAccessToken"
let
    GetHeadersParametersWithAccessToken = (optional Headers as record) =>
        let
            JwtTokens = GetJwtTokens(),
            accessToken = Record.Field(JwtTokens, "accessToken"),
            Headers = Record.Combine({
                GetHeadersParameters((Headers ?? [])),
                [Authorization = Text.Format("Bearer #{0}", {accessToken})]
            })
        in
            Headers
in
    GetHeadersParametersWithAccessToken
```

Elle appelle `GetJwtTokens()`, r√©cup√®re l'access token, et l'ajoute dans un en-t√™te `Authorization: Bearer token`. Comme √ßa, toutes vos requ√™tes authentifi√©es sont pr√™tes !

<br />

### 4. R√©cup√©ration des donn√©es et gestion de la pagination

On arrive au c≈ìur du syst√®me : la fonction qui va tout orchestrer pour r√©cup√©rer les donn√©es, page par page.

```powerquery title="FetchDataFromApi"
let
    FetchDataFromApi = (
        RelativePath as text,
        ResultsFieldName as text,
        TotalFieldName as text
    ) =>
        let
            // Fonction interne : r√©cup√®re le nombre total d'√©l√©ments
            RetrieveTotalCount = (FieldName as text) =>
                let
                    ApiResponse = HttpClientGetRequest(
                        RelativePath,
                        GetQueryParameters(),
                        GetHeadersParametersWithAccessToken()
                    ),
                    TotalCount = Record.Field(ApiResponse, FieldName)
                in
                    TotalCount,

            // Fonction interne : r√©cup√®re une page sp√©cifique
            FetchPage = (FieldName as text, PageIndex as number) =>
                let
                    Offset = (PageIndex ?? 0) * API_PAGINATION_LIMIT,
                    QueryParams = GetQueryParameters(Offset),
                    AuthHeaders = GetHeadersParametersWithAccessToken(),
                    ApiResponse = HttpClientGetRequest(
                        RelativePath,
                        QueryParams,
                        AuthHeaders
                    ),
                    Results = Record.Field(ApiResponse, FieldName)
                in
                    Results,

            // Fonction principale : r√©cup√®re toutes les pages
            GetAllData = () =>
                let
                    TotalCount = RetrieveTotalCount(TotalFieldName),
                    MaxCount = List.Max({API_PAGINATION_LIMIT, TotalCount}),
                    TotalPages = Number.RoundUp(MaxCount / API_PAGINATION_LIMIT),
                    PageIndices = {0..TotalPages - 1},
                    AllPages = List.Transform(
                        PageIndices,
                        each FetchPage(ResultsFieldName, _)
                    ),
                    CombinedPages = List.Union(AllPages),
                    DataTable = Table.FromList(
                        CombinedPages,
                        Splitter.SplitByNothing(),
                        null,
                        null,
                        ExtraValues.Error
                    ),
                    ColumnIndices = List.Positions(Table.ColumnNames(DataTable)),
                    RecordColumnIndex = List.First(
                        List.Select(
                            ColumnIndices,
                            each Type.Is(
                                Value.Type(Record.FieldValues(DataTable{0}){_}),
                                type record
                            )
                        )
                    ),
                    RecordColumnName = Table.ColumnNames(DataTable){RecordColumnIndex},
                    RecordFieldNames = Record.FieldNames(
                        Record.FieldValues(DataTable{0}){RecordColumnIndex}
                    ),
                    ExpandedTable = Table.ExpandRecordColumn(
                        DataTable,
                        RecordColumnName,
                        RecordFieldNames,
                        RecordFieldNames
                    )
                in
                    ExpandedTable
        in
            GetAllData()
in
    FetchDataFromApi
```

Je ne vais pas entrer dans les d√©tails de chaque ligne de code, je vous encourage √† examiner le code pour bien comprendre son fonctionnement. Mais voici ce que fait cette fonction :

1. Elle a besoin de trois infos :
   - `RelativePath` : le chemin de l'API (exemple : "auth/products")
   - `ResultsFieldName` : le nom du champ qui contient les r√©sultats (exemple : "products")
   - `TotalFieldName` : le nom du champ qui indique le total (exemple : "total")

2. Elle compte d'abord : Elle fait un premier appel juste pour savoir combien il y a d'√©l√©ments au total. Comme quand vous regardez le nombre de pages d'un livre avant de le lire

3. Elle r√©cup√®re page par page : Elle calcule combien de pages il faut t√©l√©charger, puis elle va chercher chaque page l'une apr√®s l'autre

4. Elle assemble le tout : Toutes les pages sont combin√©es en une seule grande liste
5. Elle nettoie et structure : La liste est transform√©e en un beau tableau Power Query, avec toutes les colonnes bien d√©pli√©es et organis√©es

En gros, vous lui donnez le chemin de l'API et les noms des champs importants, et elle vous rend un tableau complet avec toutes les donn√©es. Magique, non ?

<br />

### 5. Organisation de vos fonctions

Petit conseil d'organisation : cr√©ez des dossiers dans Power Query pour ranger vos param√®tres et fonctions. √áa aide vraiment √† maintenir un projet propre !

Voici comment je structure mes projets par exemple :

<PostImage
  src="https://github.com/user-attachments/assets/e444438f-4049-44dc-b3d4-7ba0a02e5cbc"
  alt="Project file structure"
/>

<br />

## Importation des donn√©es dans Power BI (Utilisation de la fonction `FetchDataFromApi`)

Maintenant que tout est en place, voyons √† quel point c'est simple d'utiliser notre travail !

### R√©cup√©rer les produits

Cr√©ez une nouvelle requ√™te vide et collez ce code :

```powerquery title="Products"
let
    Source = FetchDataFromApi("auth/products", "products", "total")
in
    Source
```

C'est tout ! Vraiment, c'est tout.

<PostImage
  src="https://github.com/user-attachments/assets/98112183-8faa-45f5-9195-aefa07a85ba7"
  alt="Powerquery code for products query"
/>

Cliquez sur `Terminer` et admirez vos donn√©es qui se chargent :

<PostImage
  src="https://github.com/user-attachments/assets/7860a108-f550-472c-b548-6162fb55bb72"
  alt="Products query"
/>

### R√©cup√©rer les utilisateurs

M√™me principe, c'est tout aussi simple :

```powerquery title="Users"
let
    Source = FetchDataFromApi("auth/users", "users", "total")
in
    Source
```

Vous voyez ? Une fois que vous avez fait le travail de base, ajouter de nouvelles sources de donn√©es devient un jeu d'enfant !

<Note variant='tip'>
  **Visualisez vos d√©pendances**
  
  Power Query propose une vue super pratique appel√©e "D√©pendances de requ√™tes" qui vous montre graphiquement comment toutes vos fonctions et requ√™tes sont connect√©es. C'est parfait pour :
  - Comprendre la structure de votre projet d'un coup d'≈ìil
  - V√©rifier que tout est bien reli√©
  - Rep√©rer d'√©ventuels probl√®mes de d√©pendance
  
  Pour y acc√©der : Onglet `Affichage` > `D√©pendances de requ√™tes`

  <PostImage
    src="https://github.com/user-attachments/assets/12c9c406-b640-46d5-9268-c4a73518954b"
    alt="Query Dependencies"
  />
</Note>

<br />

## Conclusion

Voil√†, on a fait le tour !

Dans cet article, on a vu ensemble comment :
- Structurer proprement un projet Power Query avec des param√®tres et des fonctions r√©utilisables
- G√©rer l'authentification JWT avec une API
- R√©cup√©rer automatiquement toutes les pages de donn√©es gr√¢ce √† la pagination
- Transformer tout √ßa en tableaux propres et pr√™ts √† l'emploi dans Power BI

Le gros avantage de cette approche, c'est que maintenant vous avez un syst√®me r√©utilisable. Besoin de connecter une nouvelle API ? Vous n'avez qu'√† adapter les param√®tres et les chemins, le reste est d√©j√† fait !

**Quelques conseils pour aller plus loin :**
- Adaptez le code √† vos propres API (elles fonctionnent toutes un peu diff√©remment)
- Ajoutez de la gestion d'erreurs si n√©cessaire
- Pensez √† documenter vos fonctions avec des commentaires
- Testez toujours

Si vous avez appr√©ci√© cette approche bas√©e sur des fonctions r√©utilisables, vous allez adorer ces deux autres articles qui suivent la m√™me philosophie :

**üîó Gestion flexible des sources de donn√©es**  
Vous g√©rez des tableaux de bord qui doivent fonctionner sur diff√©rents environnements ? D√©couvrez comment <Link href="https://macktireh.com/fr/posts/flexible-data-source-management-power-bi-mysql/" external>adapter dynamiquement vos connexions MySQL selon l'environnement</Link> (d√©veloppement, test, production). C'est le compl√©ment parfait de cet article si vous travaillez avec des bases de donn√©es volumineuses et que vous voulez √©viter de reconfigurer manuellement vos sources √† chaque fois.

**üìÅ Importer plusieurs fichiers Excel/CSV proprement**  
Marre de voir votre √©diteur Power Query pollu√© par des dizaines de requ√™tes quand vous importez plusieurs fichiers ? Je vous montre comment <Link href="https://macktireh.com/fr/posts/import-multiple-excel-csv-files-power-bi-custom-power-query-function/" external>cr√©er une fonction personnalis√©e pour combiner des fichiers Excel ou CSV</Link> de fa√ßon √©l√©gante.
